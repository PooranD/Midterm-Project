#include <WiFi.h>
#include <WebServer.h>

const char* ssid = "SSID"; 
const char* password = "PASSWORD"; 

const int ledPin = 4; 
const int scanTime = 10000;  


const char* knownMacs[] = {
  "01:23:45:67:89:AB",
  "12:34:56:78:9A:BC",
  "04:42:1A:D9:76:81",
  "A6:CF:D2:5F:9A:7B"
};

WebServer server(80);  
String logMessage = ""; 

void setup() {
  Serial.begin(115200);
  pinMode(ledPin, OUTPUT);
  digitalWrite(ledPin, LOW); 

  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(1000);
    Serial.println("Connecting to WiFi...");
  }
  Serial.println("Connected to WiFi");
  Serial.println("IP Address: " + WiFi.localIP().toString());

 
  server.on("/", handleRoot); 
  server.begin();  
  Serial.println("HTTP server started");
}

void loop() {
  server.handleClient(); 

 
  Serial.println("Scanning for devices...");
  int n = WiFi.scanNetworks();
  for (int i = 0; i < n; ++i) {
    String macAddress = WiFi.BSSIDstr(i); 
    if (!isKnownMac(macAddress)) {
      
      Serial.println("Unknown MAC Address detected: " + macAddress);
      logMessage += "Unknown MAC Address detected: " + macAddress + "\n";
      
     
      digitalWrite(ledPin, HIGH);
      delay(3000);  
      digitalWrite(ledPin, LOW);
    }
  }
  WiFi.scanDelete();
  delay(scanTime); 
}

bool isKnownMac(String macAddress) {
 
  for (const char* knownMac : knownMacs) {
    if (macAddress.equalsIgnoreCase(knownMac)) {
      return true;  
    }
  }
  return false;  
}

void handleRoot() {
 
  if (logMessage.length() > 0) {
    server.send(200, "text/plain", logMessage); 
  } else {
    server.send(200, "text/plain", "No intrusions logged.");  
  }
}
